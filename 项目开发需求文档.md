# 个人每日营养记录软件 - 项目开发需求文档

## 1. 项目概述
本项目是一个基于Go语言开发的个人每日营养记录软件，旨在帮助用户跟踪和管理日常饮食，实现健康饮食目标。

## 2. 功能需求分析

### 2.1 用户管理模块
- **用户注册**：支持邮箱/手机号注册，密码加密存储
- **用户登录**：支持邮箱/手机号+密码登录，JWT令牌认证
- **用户信息管理**：个人信息编辑（昵称、性别、年龄、身高、体重、活动水平）
- **密码重置**：通过邮箱/手机验证码重置密码

### 2.2 营养目标设置模块
- **每日营养目标设置**：根据用户信息自动计算或手动设置
  - 总热量
  - 蛋白质（克）
  - 碳水化合物（克）
  - 脂肪（克）
  - 膳食纤维（克）
  - 水分摄入量（毫升）
  - 维生素目标（可选，如维生素A、C、D、E）
  - 矿物质目标（可选，如钙、铁、镁、锌）

### 2.3 营养记录模块
- **餐次记录**：支持早餐、午餐、晚餐、加餐等多餐次记录
- **食物搜索与选择**：内置常见食物库，支持搜索和快速选择
- **营养成分记录**：
  - 基本信息：食物名称、份量、单位
  - 核心营养：热量（千卡）、蛋白质、碳水化合物、脂肪、膳食纤维
  - 宏量营养素：饱和脂肪、不饱和脂肪、反式脂肪、胆固醇
  - 维生素：维生素A、维生素C、维生素D、维生素E、维生素K、B族维生素
  - 矿物质：钙、铁、镁、磷、钾、钠、锌、碘
  - 其他：水分含量、糖分、盐分

### 2.4 数据分析与可视化模块
- **每日营养摄入统计**：实时展示当日已摄入与目标的对比
- **历史记录查询**：按日期、周、月查看历史营养记录
- **营养趋势分析**：生成营养摄入趋势图表
- **饮食建议**：根据用户的饮食记录提供个性化建议

### 2.5 食物库管理模块
- **内置食物库**：包含常见食物的营养成分数据
- **自定义食物添加**：支持用户添加自定义食物及其营养成分
- **食物分类管理**：按食物类别（如谷物、肉类、蔬菜、水果等）组织

## 3. 技术栈设计

### 3.1 后端技术栈
- **语言**：Go 1.20+
- **Web框架**：Gin
- **数据库**：PostgreSQL（主数据库）+ Redis（缓存、会话管理）
- **ORM**：GORM
- **认证**：JWT
- **配置管理**：Viper
- **日志**：Zap
- **测试**：Testify

### 3.2 前端技术栈（可选）
- **框架**：React/Vue.js
- **UI组件库**：Ant Design/Element Plus
- **状态管理**：Redux/Pinia
- **图表库**：ECharts/Chart.js

## 4. 系统架构

采用经典的分层架构：
- **API层**：处理HTTP请求和响应
- **Service层**：业务逻辑实现
- **Model层**：数据模型定义
- **Repository层**：数据库操作封装
- **Util层**：通用工具函数

## 5. 数据库设计

### 5.1 用户表（users）
| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | UUID | 用户ID |
| email | VARCHAR(255) | 邮箱 |
| phone | VARCHAR(20) | 手机号 |
| password_hash | VARCHAR(255) | 密码哈希 |
| nickname | VARCHAR(50) | 昵称 |
| gender | INT | 性别（0:未知,1:男,2:女） |
| age | INT | 年龄 |
| height | FLOAT | 身高（cm） |
| weight | FLOAT | 体重（kg） |
| activity_level | INT | 活动水平（1-5） |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### 5.2 营养目标表（nutrition_goals）
| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | UUID | 目标ID |
| user_id | UUID | 用户ID（外键） |
| calories | FLOAT | 热量目标（千卡） |
| protein | FLOAT | 蛋白质目标（克） |
| carbohydrates | FLOAT | 碳水化合物目标（克） |
| fat | FLOAT | 脂肪目标（克） |
| fiber | FLOAT | 膳食纤维目标（克） |
| water | FLOAT | 水分目标（毫升） |
| vitamin_a | FLOAT | 维生素A目标（微克） |
| vitamin_c | FLOAT | 维生素C目标（毫克） |
| vitamin_d | FLOAT | 维生素D目标（微克） |
| calcium | FLOAT | 钙目标（毫克） |
| iron | FLOAT | 铁目标（毫克） |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### 5.3 餐次记录表（meal_records）
| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | UUID | 记录ID |
| user_id | UUID | 用户ID（外键） |
| meal_type | INT | 餐次类型（1:早餐,2:午餐,3:晚餐,4:加餐） |
| record_date | DATE | 记录日期 |
| record_time | TIME | 记录时间 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### 5.4 食物记录表（food_records）
| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | UUID | 记录ID |
| meal_record_id | UUID | 餐次记录ID（外键） |
| food_id | UUID | 食物ID（外键，关联foods表） |
| custom_food_id | UUID | 自定义食物ID（外键，关联custom_foods表，与food_id二选一） |
| quantity | FLOAT | 份量 |
| unit | VARCHAR(20) | 单位（克、毫升、份等） |
| calories | FLOAT | 热量（千卡） |
| protein | FLOAT | 蛋白质（克） |
| carbohydrates | FLOAT | 碳水化合物（克） |
| fat | FLOAT | 脂肪（克） |
| fiber | FLOAT | 膳食纤维（克） |
| saturated_fat | FLOAT | 饱和脂肪（克） |
| trans_fat | FLOAT | 反式脂肪（克） |
| cholesterol | FLOAT | 胆固醇（毫克） |
| sodium | FLOAT | 钠（毫克） |
| sugar | FLOAT | 糖分（克） |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### 5.5 食物库表（foods）
| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | UUID | 食物ID |
| name | VARCHAR(100) | 食物名称 |
| category | INT | 食物类别（1:谷物,2:肉类,3:蔬菜,4:水果,5:乳制品,6:油脂,7:坚果,8:饮料等） |
| base_quantity | FLOAT | 基础份量 |
| base_unit | VARCHAR(20) | 基础单位 |
| calories | FLOAT | 热量/100克（千卡） |
| protein | FLOAT | 蛋白质/100克（克） |
| carbohydrates | FLOAT | 碳水化合物/100克（克） |
| fat | FLOAT | 脂肪/100克（克） |
| fiber | FLOAT | 膳食纤维/100克（克） |
| saturated_fat | FLOAT | 饱和脂肪/100克（克） |
| trans_fat | FLOAT | 反式脂肪/100克（克） |
| cholesterol | FLOAT | 胆固醇/100克（毫克） |
| sodium | FLOAT | 钠/100克（毫克） |
| sugar | FLOAT | 糖分/100克（克） |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### 5.6 自定义食物表（custom_foods）
| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | UUID | 自定义食物ID |
| user_id | UUID | 用户ID（外键） |
| name | VARCHAR(100) | 食物名称 |
| base_quantity | FLOAT | 基础份量 |
| base_unit | VARCHAR(20) | 基础单位 |
| calories | FLOAT | 热量/基础份量（千卡） |
| protein | FLOAT | 蛋白质/基础份量（克） |
| carbohydrates | FLOAT | 碳水化合物/基础份量（克） |
| fat | FLOAT | 脂肪/基础份量（克） |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

## 6. API接口设计

### 6.1 用户管理接口
- `POST /api/v1/auth/register` - 用户注册
- `POST /api/v1/auth/login` - 用户登录
- `POST /api/v1/auth/logout` - 用户登出
- `POST /api/v1/auth/reset-password` - 密码重置
- `GET /api/v1/user/profile` - 获取用户信息
- `PUT /api/v1/user/profile` - 更新用户信息

### 6.2 营养目标接口
- `GET /api/v1/goals` - 获取当前营养目标
- `POST /api/v1/goals` - 设置营养目标
- `PUT /api/v1/goals` - 更新营养目标

### 6.3 营养记录接口
- `GET /api/v1/records/:date` - 获取指定日期的营养记录
- `POST /api/v1/records/meal` - 创建餐次记录
- `POST /api/v1/records/food` - 添加食物记录
- `PUT /api/v1/records/food/:id` - 更新食物记录
- `DELETE /api/v1/records/food/:id` - 删除食物记录

### 6.4 食物库接口
- `GET /api/v1/foods` - 搜索食物
- `GET /api/v1/foods/:id` - 获取食物详情
- `POST /api/v1/custom-foods` - 创建自定义食物
- `GET /api/v1/custom-foods` - 获取用户自定义食物列表
- `PUT /api/v1/custom-foods/:id` - 更新自定义食物
- `DELETE /api/v1/custom-foods/:id` - 删除自定义食物

## 7. 技术实现要求

### 7.1 后端实现
- 采用Gin框架构建RESTful API
- 使用PostgreSQL存储结构化数据
- Redis缓存热点数据和管理会话
- JWT实现无状态认证
- 密码使用bcrypt加密存储
- 完善的错误处理和日志记录

### 7.2 数据库设计
- 使用GORM进行ORM映射
- 实现数据库迁移功能
- 建立合理的索引优化查询性能

### 7.3 安全要求
- 所有API接口需要认证（除了注册、登录、密码重置）
- 防止SQL注入、XSS攻击
- 敏感数据加密传输（HTTPS）
- 实现请求频率限制，防止暴力攻击

## 8. 开发计划与里程碑

### 8.1 第一阶段：基础架构搭建（2周）
- 项目结构设计
- 数据库设计与迁移
- 用户认证系统实现
- 基础API框架搭建

### 8.2 第二阶段：核心功能实现（3周）
- 用户管理模块
- 营养目标设置模块
- 营养记录模块
- 食物库基础功能

### 8.3 第三阶段：完善与优化（2周）
- 数据分析与可视化接口
- 性能优化
- 测试与bug修复
- 文档完善

### 8.4 第四阶段：部署与上线（1周）
- 生产环境部署
- 监控与日志系统搭建
- 最终测试与验收

## 9. 项目交付物

- 完整的后端源代码
- API接口文档
- 数据库设计文档
- 部署说明文档
- 单元测试和集成测试用例

## 10. 未来扩展规划

- 移动端APP开发
- 社交分享功能
- AI饮食建议
- 食谱推荐功能
- 健康报告生成